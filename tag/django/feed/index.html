<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Ikke&#039;s blog &#187; django</title>
	<atom:link href="http://eikke.com/tag/django/feed/" rel="self" type="application/rss+xml" />
	<link>http://eikke.com</link>
	<description>&#039;cause this is what I do</description>
	<lastBuildDate>Sun, 13 Feb 2011 14:58:55 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.4.1</generator>
		<item>
		<title>django-validation now includes inheritance support</title>
		<link>http://eikke.com/django-validation-now-includes-inheritance-support/</link>
		<comments>http://eikke.com/django-validation-now-includes-inheritance-support/#comments</comments>
		<pubDate>Fri, 18 Jan 2008 03:33:39 +0000</pubDate>
		<dc:creator>Nicolas</dc:creator>
				<category><![CDATA[Development]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[django-validation]]></category>
		<category><![CDATA[form]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[newforms]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[validation]]></category>

		<guid isPermaLink="false">http://eikke.com/django-validation-now-includes-inheritance-support/</guid>
		<description><![CDATA[I&#8217;m happy to announce django-validation got field type inheritance support since a couple of minutes. This means your form fields will be validated starting from the most base field type (django.newforms.Field) up to the actual field type (no multiple-inheritance supported though). In the example I wrote yesterday, when using a TestField field, this field will [...]]]></description>
			<content:encoded><![CDATA[<p>I&#8217;m happy to announce <a href="http://git.nicolast.be/?p=django-validation.git;a=summary" title="django-validation git">django-validation</a> got field type inheritance support since a couple of minutes. This means your form fields will be validated starting from the most base field type (django.newforms.Field) up to the actual field type (no multiple-inheritance supported though).</p>
<p>In <a href="http://eikke.com/django-validation-an-introduction/" title="Ikke's blog: django-validation: an introduction">the example I wrote yesterday</a>, when using a TestField field, this field will be validated as a django.newforms.Field (a &#8220;required&#8221; check will be done), then as a django.newforms.CharField (&#8220;min_length&#8221; and &#8220;max_length&#8221; checks), and finally as a TestField. A normal CharField would be validated as a Field first, then as a CharField, etc.</p>
<p>The returned errors will be a list of all errors found, starting with the most basic one (the ones found by the most general class, Field).</p>
<p>Next to this, all generated Javascript code should be namespaced now (based on Python module and class names), although there might be some bad things left, I&#8217;m no Javascript guru. The generated code might be somewhat messy.</p>
<p>Current Python code is most certainly ugly and will need more rewrites. Next to this, other field types should be added, and some tests would be nice too.</p>
<p>I made a snapshot of yesterday&#8217;s sample (with some changes, the ClientValidator API slightly changed), you can try it <a href="http://key.nicolast.be/files/django-validation-test.html" title="django-validation testpage">here</a>.</p>
]]></content:encoded>
			<wfw:commentRss>http://eikke.com/django-validation-now-includes-inheritance-support/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>django-validation: an introduction</title>
		<link>http://eikke.com/django-validation-an-introduction/</link>
		<comments>http://eikke.com/django-validation-an-introduction/#comments</comments>
		<pubDate>Tue, 15 Jan 2008 23:59:58 +0000</pubDate>
		<dc:creator>Nicolas</dc:creator>
				<category><![CDATA[Development]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[django-validation]]></category>
		<category><![CDATA[form]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[newforms]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[validation]]></category>

		<guid isPermaLink="false">http://eikke.com/django-validation-an-introduction/</guid>
		<description><![CDATA[Some time ago I wrote this generic AJAX Django form validation code. Some people didn&#8217;t like this, as AJAX should not be used to perform form validation, which is sometimes true, sometimes not, as I pointed out before. So I&#8217;ve been thinking since some time to create a Django templatetag which allows one to generate [...]]]></description>
			<content:encoded><![CDATA[<p>Some time ago I wrote this <a href="http://eikke.com/django-generic-ajax-form-validation/" title="Django generic AJAX form validation">generic AJAX Django form validation code</a>. Some people didn&#8217;t like this, as AJAX should not be used to perform form validation, which is sometimes true, sometimes not, as <a href="http://eikke.com/cellphone-bluetooth-and-reddit-rant/">I pointed out before</a>.</p>
<p>So I&#8217;ve been thinking since some time to create a <a href="http://www.djangoproject.com" title="Django">Django</a> templatetag which allows one to generate <em>client-side Javascript form validation code</em> without writing any code himself (unless using custom widgets). Today I got into it.</p>
<p><span id="more-48"></span></p>
<p>The resulting project is called <strong>django-validation</strong>. It basicly allows one to write a Newforms form class, and generate client-side validation code for this form in a template. Currently only CharField validation is implemented, more should follow soon and is easy to add.</p>
<p>Next to validation of built-in field types, one can also add code to validate custom fields. This can be done inside an inner class of the field class.</p>
<p>The current release is very alpha-grade software, a lot of enhancements could be done, and most certainly more standard field type validators should be written. Next to this, field type inheritance isn&#8217;t supported for now (so if your field type A inherits CharField, no CharField validation will be done), this should change soon.</p>
<p>Patches are, obviously, very welcome!</p>
<p>Here&#8217;s a sample how to use it. First we define a very basic form:</p>
<pre>class TestForm(forms.Form):
    first_name = forms.CharField(max_length=128)
    test = TestField(required_value=u'I like django-validation')</pre>
<p>This form uses a custom class (just for demonstration purposes). This class only performs client-side validation, no clean() function is provided, although in real field types this should obviously be added. More information can be found in the inline comments:</p>
<pre>from validation.templatetags.validation import add_error
class TestField(forms.CharField):
    def __init__(self, *args, **kwargs):
        if not 'required_value' in kwargs.keys():
            raise Exception, 'required_value should be provided'
        self.required_value = kwargs['required_value']
        del kwargs['required_value']
        super(TestField, self).__init__(*args, **kwargs)

    class ClientValidator:
        '''
        This inner class knows how to generate Javascript validation code for this field type.
        The code will be pasted inside a function block. There is at least one assigned variable, 'field',
        which is the DOM element we got to validate.

        More parameters can be defined in the 'parameters' attribute. These parameters will be added
        to the Javascript function prototype, and the value of the form field parameter value will be
        assigned.

        We need to define the field class name, so the django-validation code can generate suitable
        function names.
        '''
        parameters = ('required_value', )
        field_class = 'TestField'

        def render(self, output):
            '''
            The render function should output Javascript code to check the value of the 'field' element.
            It is called inside a Javascript function scope.

            output is a StringIO object. Normally only write or writelines calls should be used.
            '''
            output.write('value = field.value;\n')
            output.write('if(value != required_value) {\n')
            # This error message should be internationalized.
            # See the add_error documentation.
            add_error(output, 'error_msg', 'Field value should be %(value)d.', (('%(value)d', 'required_value'), ))
            output.write('    return [error_msg];\n')
            output.write('}\n')</pre>
<p>Finally, here&#8217;s how to use it inside a template (this must be one of the worse HTML/Javascript snippets I ever wrote):</p>
<pre>{% load validation %}
&lt;html&gt;
&lt;body&gt;
    &lt;form&gt;
        {{ form.as_p }}
        &lt;p&gt;&lt;input type="submit" onclick="return testform(this.form);" /&gt;
    &lt;/form&gt;
    &lt;div id="errors"&gt;&lt;/div&gt;
    {% validation_js form 'validate_testform' %}
    &lt;script type="text/javascript"&gt;
        function testform(form) {
            valid = true;
            errors = validate_testform(form);
            err = "&lt;ul&gt;";
            for(field in errors) {
                if(errors[field] != null) {
                    err += '&lt;li&gt;' + field + ': ' + errors[field][0] + '&lt;/li&gt;';
                    valid = false;
                }
            }
            err += '&lt;/ul&gt;';
            if(valid)
                err = 'Form is valid';
            document.getElementById('errors').innerHTML = err;
            return false;
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<p>The current code is available in <a href="http://git.nicolast.be/?p=django-validation.git;a=summary" title="django-validation git">a git repository</a>. Enjoy!</p>
]]></content:encoded>
			<wfw:commentRss>http://eikke.com/django-validation-an-introduction/feed/</wfw:commentRss>
		<slash:comments>6</slash:comments>
		</item>
		<item>
		<title>Django generic AJAX form validation</title>
		<link>http://eikke.com/django-generic-ajax-form-validation/</link>
		<comments>http://eikke.com/django-generic-ajax-form-validation/#comments</comments>
		<pubDate>Mon, 31 Dec 2007 13:20:26 +0000</pubDate>
		<dc:creator>Nicolas</dc:creator>
				<category><![CDATA[Development]]></category>
		<category><![CDATA[ajax]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[form]]></category>
		<category><![CDATA[javascript]]></category>
		<category><![CDATA[jquery]]></category>
		<category><![CDATA[newforms]]></category>
		<category><![CDATA[snippet]]></category>
		<category><![CDATA[validation]]></category>

		<guid isPermaLink="false">http://eikke.com/django-generic-ajax-form-validation/</guid>
		<description><![CDATA[I just created a generic view for Django which allows a developer to easily add AJAX-style form validation to a newforms based form. The system needs one server-side view, and some client-side JavaScript. You can find the view code in my Django snippets Git repository. The view only works with POST requests. It takes a [...]]]></description>
			<content:encoded><![CDATA[<p>I just created a generic view for <a href="http://www.djangoproject.com" title="Django">Django</a> which allows a developer to easily add AJAX-style form validation to a <a href="http://www.djangoproject.com/documentation/newforms" title="Django newforms documentation">newforms</a> based form.</p>
<p>The system needs one server-side view, and some client-side JavaScript. You can find the <a href="http://git.nicolast.be/?p=django-snippets.git;a=blob;f=ajax/form-validation-view.py;hb=HEAD" title="Django AJAX form validation view">view code</a> in my <a href="http://git.nicolast.be/?p=django-snippets.git;a=summary" title="Django snippets">Django snippets Git repository</a>. The view only works with POST requests. It takes a standard HttpRequest and some options:</p>
<ul>
<li>form_class: this parameter defines the newforms class to validate against. It can be specified in the extra args parameter of the view&#8217;s urlconf. If you don&#8217;t specify it, the &#8216;form_class&#8217; POST field will be used. If this doesn&#8217;t exist either, an exception is raised. The parameter can be a newforms form instance, a string, or a class (which should be a subclass of BaseForm).</li>
<li>format: the serialization format to use. Currently only &#8216;json&#8217; is supported.</li>
<li>args: extra argument list to provide to the form constructor (shouldn&#8217;t be provided in most cases)</li>
<li>kwargs: extra argument dics to provide to the form constructor (shouldn&#8217;t be provided in most cases)</li>
</ul>
<p>Next to the server-side view you&#8217;ll need some pretty basic JavaScript code on client side. I use <a href="http://www.jquery.com" title="JQuery">JQuery</a> and the <a href="http://www.malsup.com/jquery/form/" title="JQuery form plugin">JQuery Form plugin</a>. Here&#8217;s some sample code, assuming the form ID is &#8216;my_form&#8217;, and form fields are represented like this:</p>
<pre>&lt;p id="{{ form.field.name }}_container"&gt;&lt;label for="{{ form.field.auto_id }}"&gt;{{ form.field.label|capfirst }}:&lt;/label&gt;{{ form.field }}
{% if form.field.errors %}&lt;span id="{{ form.field.name }}_error" class="error"&gt;{{ form.field.errors.0 }}&lt;/span&gt;{% endif %}
&lt;/p&gt;</pre>
<p>Here&#8217;s the corresponding JavaScript code:</p>
<pre>function do_something() {
}
function process_validation(data) {
    if(data['form_valid'] == true) {
        do_something();
        return;
    }
    for(var field in data["errors"]) {
        errors = data["errors"][field]
        if(errors.length &gt; 0) {
            error = errors[0];
            if($("#" + field + "_error").length == 0) {
                s = $("&lt;br /&gt;&lt;span style=\"display: none;\" id=\"" + field + "_error\" class=\"error\"&gt;" + error + "&lt;/span&gt;");
                $("#" + field + "_container").append(s);
            }
            $("#" + field + "_error").html(error).fadeIn("slow");
        }
    }
}
function validate_form(data) {
    data.push({name: 'form_class', value: 'project.application.forms.ApplicationForm'});
    $.post("{% url validate_form %}", data, process_validation, "json");
}
$(document).ready(function() {
    $("#my_form").submit(function() {
        data = $("#my_form").formToArray();
        $(".error").fadeOut("slow");
        validate_form(data);
        return false;
    });
});</pre>
<p>Obviously this should be changed to suit your needs.</p>
<p>I hope this code can be useful for someone&#8230;</p>
]]></content:encoded>
			<wfw:commentRss>http://eikke.com/django-generic-ajax-form-validation/feed/</wfw:commentRss>
		<slash:comments>10</slash:comments>
		</item>
		<item>
		<title>Filesystem issues and django-couchdb work</title>
		<link>http://eikke.com/filesystem-issues-and-django-couchdb-work/</link>
		<comments>http://eikke.com/filesystem-issues-and-django-couchdb-work/#comments</comments>
		<pubDate>Sun, 30 Dec 2007 01:47:22 +0000</pubDate>
		<dc:creator>Nicolas</dc:creator>
				<category><![CDATA[Development]]></category>
		<category><![CDATA[Linux]]></category>
		<category><![CDATA[couchdb]]></category>
		<category><![CDATA[crash]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[evolution]]></category>
		<category><![CDATA[fglrx]]></category>
		<category><![CDATA[firefox]]></category>
		<category><![CDATA[gnome]]></category>
		<category><![CDATA[jfs]]></category>
		<category><![CDATA[pidgin]]></category>

		<guid isPermaLink="false">http://eikke.com/filesystem-issues-and-django-couchdb-work/</guid>
		<description><![CDATA[Last night, when shutting down my laptop (which had been up for quite a long time because of suspend/resume niceness), it crashed. I don&#8217;t know what exactly happened: pressed the GNOME&#8217;s logout button, applications were closed, until only my background was visible, then the system locked up, so I suspect my X server (some part [...]]]></description>
			<content:encoded><![CDATA[<p>Last night, when shutting down my laptop (which had been up for quite a long time because of suspend/resume niceness), it crashed. I don&#8217;t know what exactly happened: pressed the GNOME&#8217;s logout button, applications were closed, until only my background was visible, then the system locked up, so I suspect my X server (some part of it, GPU driver (fglrx) might be the bad guy). I was able to sysrq s u o, so I thought everything would be relatively fine.</p>
<p>This morning I powered on my system, and while booting, fsck of some partitions was taking a rather long time. It&#8217;s pretty normal fsck was taking somewhat longer, but not th√°t long&#8230; I&#8217;m using JFS on most logical volumes.</p>
<p>When the consistency check of my /home partition was done, a whole load of invalid files was displayed and later on moved to lost+found: 34068 files. Once booted, I scanned my filesystems again, rebooted, logged in, started X. Everything started fine, until I launched Evolution: it presented my the &#8216;initial run&#8217; wizard. Other issues (on first sight): all Firefox cookies were gone, and Pidgin&#8217;s blist.xml was corrupted. When using my old computer (which had frequent lockups on heavy IO usage) these last 2 issues happened a lot too, which is highly annoying, especially the blist.xml thing as I can&#8217;t see any reason to keep this file opened for long periods?</p>
<p>Luckily I was able to get my Evolution up and running again by restoring it&#8217;s GConf settings and ~/.evolution using some old backup (15/10/07). I guess I should backup more regularly&#8230; Next to this I hope I won&#8217;t find any other corrupted files, so the ones in lost+found are just Evolution email files and Firefox caches.</p>
<p>Anyway, here&#8217;s a screenshot displaying some of the initial and hackish work I&#8217;ve done this evening on integrating <a href="http://www.djangoproject.com" title="Django">Django</a> and <a href="http://www.couchdb.org" title="CouchDB">CouchDB</a> as <a href="http://eikke.com/couchdb-with-python" title="Python, CouchDB and Python">I wrote about yesterday</a>:</p>
<p><a href="http://eikke.com/filesystem-issues-and-django-couchdb-work/django-and-couchdb-first-shot-2/" rel="attachment wp-att-15" title="Django and CouchDB first shot"><img src="http://eikke.com/wp-content/uploads/2007/12/django_couchdb12.thumbnail.png" alt="Django and CouchDB first shot" /></a></p>
<p>As you can see, currently I&#8217;m able to edit fields of an object. There&#8217;s one major condition: an object with the given ID should already exist in the &#8216;database&#8217; which makes the current code rather useless, but hey <img src='http://eikke.com/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' />  I&#8217;ll add object creation functionality later tonight or tomorrow.</p>
<p>Current code is very expensive too, doing way too many queries to CouchDB, mainly in client.py. This most certainly needs work.</p>
<p>Upgraded my <a href="http://www.wordpress.org" title="WordPress">WordPress</a> installation to the latest release, 2.3.2, in about 5 seconds. Got to love svn switch (although maybe I should start using git-svn for this installation too and git-pull the release branch in my local copy).</p>
]]></content:encoded>
			<wfw:commentRss>http://eikke.com/filesystem-issues-and-django-couchdb-work/feed/</wfw:commentRss>
		<slash:comments>9</slash:comments>
		</item>
		<item>
		<title>CouchDB with Python</title>
		<link>http://eikke.com/couchdb-with-python/</link>
		<comments>http://eikke.com/couchdb-with-python/#comments</comments>
		<pubDate>Sat, 29 Dec 2007 01:25:52 +0000</pubDate>
		<dc:creator>Nicolas</dc:creator>
				<category><![CDATA[Development]]></category>
		<category><![CDATA[couchdb]]></category>
		<category><![CDATA[django]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://eikke.com/couchdb-with-python/</guid>
		<description><![CDATA[Today I&#8217;ve been investigating CouchDB a little better (only heard some rumors about it before). It&#8217;s actually a pretty nice technology which can, in some places, be pretty useful&#8230; I tend to compare it to caching serialized PHP associative arrays or Python dict&#8217;s in a Memcached server using some specific prefixes, except it&#8217;s not really [...]]]></description>
			<content:encoded><![CDATA[<p>Today I&#8217;ve been investigating <a href="http://www.couchdb.org" title="CouchDB">CouchDB</a> a little better (only heard some rumors about it before). It&#8217;s actually a pretty nice technology which can, in some places, be pretty useful&#8230; I tend to compare it to caching serialized <a href="http://www.php.net" title="PHP">PHP</a> associative arrays or <a href="http://www.python.org" title="Python">Python</a> dict&#8217;s in a <a href="http://www.danga.com/memcached/" title="Memcached">Memcached</a> server using some specific prefixes, except it&#8217;s not really memory-based (it&#8217;s persistent), you get a complete query interface (views), there&#8217;s dataset versioning support (!), etc. While writing this I start to wonder what similarities I ever saw between CouchDB and a Python pickled dict in Memcached&#8230;</p>
<p>Anyway, one use case I saw was site user profiles: profile data is most of the time not relational at all, so why store it in a relational database, which makes it sometimes rather hard to add extra profile information fields, unless you use some dirty &#8216;save serialized form&#8217; trick, which renders your data unqueryable? Storing profile information (using eg. a user&#8217;s primary email address or login name as key for the user profile document) in CouchDB allows you to extend the profile &#8220;schema&#8221; easily: just add a field to your profile editting form, make sure it&#8217;s processed server-side an stored in the profile document, and add some extra code to your profile rendering template so the extra field get displayed too. No need to alter SQL tables at all!</p>
<p>As in my last site project I also have some sort of user profiles, I was thinking about using CouchDB for storage of these objects. As the site is written using <a href="http://www.djangoproject.com" title="Django">Django</a>, it would be nice to be able to define a standard Django model for the profile, which would be stored in CouchDB, not insome SQL server. This way you can still enjoy newforms goodness, among others.</p>
<p>So I started some new project, called django-couchdb, which should in time provide a model base class (similar to django.db.models.Model), corresponding managers to query the data, and so on. I don&#8217;t know (yet) whether all this is possible to achieve, anyway, I started by creating a very basic Python class which allows you to access a CouchDB server in a very Pythonic way: using dicts. A Server is a dict consisting of Databases, a Database is a dict of Documents. All this implemented thanks to the goodness of the DictMixin base class.</p>
<p>The client is not finished yet, at least 3 TODO items are on my list:</p>
<ul>
<li>Error/Exception handling</li>
<li>Revision handling</li>
<li>View support</li>
</ul>
<p>Currently there is no support for any of these. Views should be easy to add, error handling a little harder. I think revision handling is the hardest part, escpecially on figuring out how to provide this functionality in a Pythonic manner.</p>
<p>You can find the current code in <a href="http://git.nicolast.be/?p=django-couchdb.git;a=summary" title="django-couchdb Git repository">this Git repository</a>. Patches or external branches are very welcome!</p>
<p>By the way: the website I referred to  before has been launched. It&#8217;s only of any use (well, maybe) for dutch-speaking users though. You can visit it <a href="http://crushmatch.be" title="crushmatch.be">here</a>. Yes, the template will change.</p>
]]></content:encoded>
			<wfw:commentRss>http://eikke.com/couchdb-with-python/feed/</wfw:commentRss>
		<slash:comments>5</slash:comments>
		</item>
		<item>
		<title>Django domain redirect middleware</title>
		<link>http://eikke.com/django-domain-redirect-middleware/</link>
		<comments>http://eikke.com/django-domain-redirect-middleware/#comments</comments>
		<pubDate>Wed, 26 Dec 2007 15:02:12 +0000</pubDate>
		<dc:creator>Nicolas</dc:creator>
				<category><![CDATA[Development]]></category>
		<category><![CDATA[django]]></category>

		<guid isPermaLink="false">http://eikke.com/2007/12/26/django-domain-redirect-middleware/</guid>
		<description><![CDATA[Most web developers know it&#8217;s possible to serve one site on several domains or subdomains, using eg. the ServerAlias Apache directive. Sometimes this behaviour is not wanted: you want your main domain to be &#8220;foo.tld&#8221;, although &#8220;www.foo.tld&#8221; should work too, and maybe even some completely different domains. This way it&#8217;s possible to have permalinks, and [...]]]></description>
			<content:encoded><![CDATA[<p>Most web developers know it&#8217;s possible to serve one site on several domains or subdomains, using eg. the <a href="http://httpd.apache.org/docs/2.0/mod/core.html#serveralias" title="Apache ServerAlias directive">ServerAlias</a> <a href="http://httpd.apache.org" title="Apache HTTPD">Apache</a> directive. Sometimes this behaviour is not wanted: you want your main domain to be &#8220;foo.tld&#8221;, although &#8220;www.foo.tld&#8221; should work too, and maybe even some completely different domains.</p>
<p>This way it&#8217;s possible to have permalinks, and you won&#8217;t get bad points from search engine spiders who don&#8217;t like the same content to be available on several URIs.</p>
<p>In <a href="http://www.djangoproject.com" title="Django">Django</a> there&#8217;s the <a href="http://www.djangoproject.com/documentation/settings/#prepend-www" title="Django PREPEND_WWW documentation">PREPEND_WWW</a> setting, which will force all requests to be redirected to www.foo.bar when coming in on foo.bar, etc. This functionality is rather limited though. As I wanted to be able to have one unique main domain in my new application, I wrote a middleware which accomplishes this in a very generic way, using the <a href="http://www.djangoproject.com/documentation/sites/" title="django.contrib.sites documentation">django.contrib.sites</a> framework. You need to add this middleware before all others in your settings file, even before the CommonMiddleware.</p>
<p>Here&#8217;s the code:</p>
<pre>from django.contrib.sites.models import Site
from django.http import HttpResponsePermanentRedirect
from django.core.urlresolvers import resolve
from django.core import urlresolvers
from django.utils.http import urlquote

class DomainRedirectMiddleware(object):
    def process_request(self, request):
        host = request.get_host()
        site = Site.objects.get_current()

        if host == site.domain:
            return None

        # Only redirect if the request is a valid path
        try:
            # One issue here: won't work when using django.contrib.flatpages
            # TODO: Make this work with flatpages <img src='http://eikke.com/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> 
            resolve(request.path)
        except urlresolvers.Resolver404:
            return None

        new_uri = '%s://%s%s%s' % (
                request.is_secure() and 'https' or 'http',
                site.domain,
                urlquote(request.path),
                (request.method == 'GET' and len(request.GET) &gt; 0) and '?%s' % request.GET.urlencode() or ''
            )

        return HttpResponsePermanentRedirect(new_uri)</pre>
<p>Make sure you got the sites framework set up correctly when using this! As noted in the code, this doesn&#8217;t work with the <a href="http://www.djangoproject.com/documentation/flatpages/" title="django.contrib.flatpages documentation">Flatpages</a> framework yet, this is TODO.</p>
]]></content:encoded>
			<wfw:commentRss>http://eikke.com/django-domain-redirect-middleware/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
		</item>
		<item>
		<title>Two Django snippets</title>
		<link>http://eikke.com/two-django-snippets/</link>
		<comments>http://eikke.com/two-django-snippets/#comments</comments>
		<pubDate>Wed, 26 Dec 2007 02:11:44 +0000</pubDate>
		<dc:creator>Nicolas</dc:creator>
				<category><![CDATA[Development]]></category>
		<category><![CDATA[django]]></category>

		<guid isPermaLink="false">http://eikke.com/2007/12/26/two-django-snippets/</guid>
		<description><![CDATA[Last 2-3 days I&#8217;ve been working on this new site project. As (almost) all web projects I started last 2 years, I&#8217;m using the Django framework to develop the site, as I just love it for several reasons. Tonight I&#8217;d like to share 2 snippets. The first one is one I use quite regularly. It&#8217;s [...]]]></description>
			<content:encoded><![CDATA[<p>Last 2-3 days I&#8217;ve been working on this new site project. As (almost) all web projects I started last 2 years, I&#8217;m using the <a href="http://www.djangoproject.com" title="Django">Django</a> framework to develop the site, as I just love it for several reasons.</p>
<p>Tonight I&#8217;d like to share 2 snippets. The first one is one I use quite regularly. It&#8217;s a replacement for django.shortcuts.render_to_response, which requires one to always add a RequestContent keyword argument to be able to access MEDIA_URL etc in templates.</p>
<p>This replacement (which I mostly put in utils/shortcuts.py) is completely API-compatible with the default render_to_response implementation, but if you pass it a request object as first parameter (and no context_instance), it automaticly uses a RequestContext.</p>
<pre>from django.shortcuts import render_to_response as real_render_to_response
from django.http import HttpRequest
from django.template.context import RequestContext

def render_to_response(*args, **kwargs):
    # Check old API
    if len(args) &gt; 0 and not isinstance(args[0], HttpRequest):
        return real_render_to_response(*args, **kwargs)
    if not kwargs.get('context_instance', None):
        kwargs['context_instance'] = RequestContext(args[0])

    return real_render_to_response(*args[1:], **kwargs)</pre>
<p>The second one is an custom form which can be used with the <a href="http://code.google.com/p/django-contact-form/" title="django-contact-form">django-contact-form</a> application. It automaticly uses the name and email address of the user if logged in, otherwise provides the standard text input fields.</p>
<p>It might be a good example of how to implement a custom widget, and how to set per-form-instance values of widgets.</p>
<p>Do note you will need to change some things around line 29.</p>
<pre>class ConstOrTextInput(forms.TextInput):
    def __init__(self, *args, **kwargs):
        super(ConstOrTextInput, self).__init__(*args, **kwargs)
        self.const_value = None

    def value_from_datadict(self, *args, **kwargs):
        if not self.const_value:
            return super(forms.TextInput, self).value_from_datadict(*args, **kwargs)
        return self.const_value

        def render(self, *args, **kwargs):
            if not self.const_value:
                return super(forms.TextInput, self).render(*args, **kwargs)
            else:
                from django.utils.safestring import mark_safe
                return mark_safe(u'<label class="form_const_value">%s</label>' % self.const_value)

class UserdataContactForm(ContactForm):
    name = forms.CharField(max_length=100,
                                           widget=ConstOrTextInput(attrs=attrs_dict),
                                           label=u'Your name')
    email = forms.EmailField(widget=ConstOrTextInput(attrs=dict(attrs_dict,
                                           maxlength=200)),
                                           label=u'Your email address')

    def __init__(self, data=None, request=None, *args, **kwargs):
        super(UserdataContactForm, self).__init__(data, request, *args, **kwargs)
        if request.user.is_authenticated():
            self.fields['name'].widget.const_value = request.user.get_profile().get_display()
            self.fields['email'].widget.const_value = request.user.email
        else:
            self.fields['name'].widget.const_value = None
            self.fields['email'].widget.const_value = None

    def from_email(self):
        if self.request and self.request.user.is_authenticated():
            return self.request.user.email
        else:
            return super(UserdataContactForm, self).from_email</pre>
<p>I added this to the end of the forms.py from the django-contact-form application, if you place it elsewhere, some more changes might be necessary.</p>
<p>I hope this is useful for at least someone!</p>
]]></content:encoded>
			<wfw:commentRss>http://eikke.com/two-django-snippets/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		</item>
	</channel>
</rss>

<!-- Dynamic page generated in 0.216 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-12-11 21:33:37 -->
<!-- Compression = gzip -->